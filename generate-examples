#!/usr/bin/env bash
set -euo pipefail

# Output file
output_file="examples.txt"
: > "$output_file"

# Process all .c files in examples
echo "Converting examples to Base64 encoding..."

for c_file in /opt/examples/*.c; do
    if [ -f "$c_file" ]; then
        filename=$(basename "$c_file")
        echo -n "Processing $filename... "

        printf "$filename#" >> "$output_file"
        # Encode the file with base64 and write to output (one line per file)
        perl -MMIME::Base64 -0777 -ne 'print encode_base64($_, "")' "$c_file" >> "$output_file"
        echo "" >> "$output_file"

        echo "done"
    fi
done

echo "All examples encoded and written to $output_file"
